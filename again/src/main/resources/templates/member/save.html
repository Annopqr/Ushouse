<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>회원가입</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/53a8c415f1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="/css/signup.css">
    
    

	<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
</head>


<body>
<div class="wrap">
<div class="signup">	
	<h2>회원가입</h2>
	
			<div class="signup_id">
	           	<h4>이메일</h4>
				<input type="text" id="email" placeholder="이메일을 입력하세요">
				<button class="check_button" onclick="send()">인증 이메일 발송</button><br>
				<input type="text" id="inputcode" placeholder="인증 번호를 입력하세요">

				<input type="hidden" id = "code">
				<button class="check_button" onclick="check()">확인</button><br>

				<div id="codecode">


				</div>
           
           	</div>
        <form action="/member/save" method="post">
            
            <div class="signup_name">
                <h4>이름</h4>
                <input type="text" name="memberName" placeholder="이름을 입력하세요">
            </div>
         
         
            	<h4>성별</h4>
            	<div>
            		<input type = "radio" name="Gender" value="MAN">
            		남
            		<input type = "radio" name="Gender" value="WOMAN">
            		여
            	</div>
           
       
            <div class="signup_id">
                <h4>Id</h4>
                <input type="text" name="memberEmail" id="memberEmail" placeholder="아이디를 입력하세요">
                <button type="button" class="check_button" onclick="emailCheck()" required>중복검사</button>
				<br>
				<span id="check-result"></span><br>
            </div>
             <div class="signup_pw">
                <h4>Password</h4>
                <input type="password" name="memberPassword" placeholder="비밀번호를 입력하세요">
            </div>

           

            
            
			<div class="signup_etc1">
                <div class="checkbox">
                  <input type="checkbox"  name="" id=""> (필수) 이용약관에 동의합니다.
                  <a href="/member/terms1" id="view-terms">보기</a>
                </div>
              </div>
              
              <div class="signup_etc2">
                <div class="checkbox">
                  <input type="checkbox" name="" id=""> (필수) 개인정보 수집 및 이용에 대한 안내에 동의합니다.
                  <a href="/member/terms2" id="view-terms">보기</a>
                </div>
              </div>	
           		
              
              


            <div class="submit">
                <input type="submit" value="회원가입">
            </div>
        </form>
        	
             
	</div>        
</div>
<script src="/js/chat.js"></script>
</body>



<script th:inline="javascript">
	









	const emailCheck = () =>{
		const email = document.getElementById("memberEmail").value;
		// 현재 문서에서 id가 memberEmail인 요소에 접근한다. .value id에 입력된 값에 접근
		// 즉, 중복 확인을 위해서 클라이언트가 입력한 값에 대하여 접근
		// 클라이언트가 입력한 입력값에 접근 후 그 값을 const변수 email에 저장 후 변수 email출력 console.log("입력값" + email);
		
		// 문서에서 id가 check-result인 요소에 접근 
		const checkResult = document.getElementById("check-result");
		
		
		console.log("입력값 :" + email);
		
		// 값을 가지고 온 후 이제 이 값을 ajax로 보내자.
		$.ajax({
			// 요청방식: post, url: "/member/email-check" - data를 받을 컨트롤러의 주소 값, 보내야 할 데이터: 이메일 값 -- controller에게 보낼것
			type: "post",
			url: "/member/email-check",
			data: {
				"memberEmail" : email
			},
			success: function(res){
				console.log("성공",res);
				if (res == "ok"){
					console.log("사용가능");
					checkResult.innerHTML = "사용이 가능합니다.";
				}else{
					console.log("사용불가");
					checkResult.innerHTML = "<p class='password-mismatch'>사용이 불가합니다.</p>";
				}
			},
			error: function(err){
				console.log("실패", err);
			}
			
		});
	}
	
	const send = () => {
		const email = document.getElementById("email").value;
		console.log("이메일", email);
		
		$.ajax({
			type:"post",
			url: "/email/auth",
			data:{
				"email": email
			},
			success: function(res){
				console.log("오케이", res);
				document.getElementById('code').value = res;
				
				
				alert("해당 이메일로 인증번호 발송이 완료되었습니다. \n 확인부탁드립니다.")
			},
			error: function(err){
				console.log("에러입니다.",err);
			}
		});
	}

	const check = () => {
		const code = document.getElementById("code").value;
		const inputcode = document.getElementById("inputcode").value;
		console.log("code: " + code);
		console.log("inputcode: " + inputcode);
		if(code == inputcode){
			console.log("일치합니다.");
			let output = "<h3>일치합니다.</h3>";
			document.getElementById('codecode').innerHTML = output;
		}else{
			console.log("일치하지않습니다.");
			let output = "<h3 class='password-mismatch'>일치하지 않습니다.</h3>";
			document.getElementById('codecode').innerHTML = output;
		}
	}

</script>
</html>